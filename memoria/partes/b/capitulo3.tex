\chapter{Arquitectura y Diseño}

\lettrine[lines=1,slope=4pt,findent=0pt]{E}{}n este apartado nos centramos plenamente en lo que al diseño se refiere.\\

Los pasos a seguir son: primero describiremos la arquitectura de pizarra mediante un esquema y un diagrama UML de casos de uso; después, analizaremos el diseño en función de los requisitos obtenidos anteriormente y finalmente, diseñaremos la plataforma.

\section{Arquitectura}
Ahora vamos a centrarnos en definir gráficamente la arquitectura, en todo momento tenemos en cuenta los requisitos obtenidos en el capítulo anterior (\textit{Véase apartado \ref{reqdiseñopiz}}).

\subsection[Estructura de la arquitectura]{Estructura de nuestra arquitectura de pizarra}
Para conocer un poco más nuestra arquitectura, es necesario realizar ciertos esquemas o diagramas. Este es uno de ellos que hacen que se entienda bastante bien la arquitectura:

\begin{figure}[H]
\begin{center}
\figura{defarquitectura}
\end{center}
\caption[Estructura de la arquitectura]{Esquema donde se define la estructura básica de nuestra arquitectura de pizarra}
\end{figure}

Con esto queda claro como se organizan los agente con la pizarra, pero a grandes rasgos.

\subsection{Análisis de la estructura}
Para dar un poco más de detalle y ver de que manera se relacionan agente y pizarra, hemos construido un diagrama de casos de uso (\textit{Véase apartado \ref{casosdeuso}}) a partir de los requisitos obtenidos previamente (\textit{Véase apartado \ref{reqdiseñopiz}}), este ha sido el resultado:

\begin{figure}[H]
\centering
\casosdeuso\label{casodeuso1}
\caption{Diagrama de casos de uso de la arquitectura}
\end{figure}

Como se puede apreciar en la \emph{figura \ref{casodeuso1}} los agentes se comunican a la pizarra mediante \emph{Comprobar nivel} y \emph{Actualizar estado}, esto significa que en esas funcionalidades habrá que incluir la conexión entre ambos.\\

Por otro lado, se trata de un diagrama sencillo que no tiene gran contenido, como era de esperar.

\section{Diseño inicial o análisis}
En este apartado el principal objetivo es realizar un análisis de los requisitos obtenidos y un diseño previo, similar al realizado en el apartado anterior, sólo que en este caso de una manera más completa.\\

En primer lugar diseñaremos un diagrama de casos de uso que permite ver de una forma más detallada los requisitos extraídos anteriormente así como su relación con los distintos actores, para después analizar de forma detallada mediante diagramas de actividad cada uno de los casos de uso resultantes. Para finalizar, incluiremos un diagrama de clases que permita una visión general de las clases que componen la plataforma y su relación.\\


\subsection{Diagrama de casos de uso}\label{casosdeuso}
Un diagrama de casos de uso permite la visualización de las actividades que se permite realizar la plataforma. A estas actividades se las denomina \textit{casos de uso}. El diagrama de casos de uso define también los actores o roles que interactúan con la aplicación y las relaciones que existen entre los distintos casos de uso. Las relaciones pueden ser de dos tipos:

\begin{itemize}
	\item \textbf{Inclusión:} Un caso de uso depende del resultado de otro.
	\item \textbf{Extensión:} Un caso de uso se extiende en otros casos que, son esencialmente similares pero varían ligeramente su comportamiento.
\end{itemize}

En nuestro caso, nuestra aplicación consta de tres actores:
\begin{itemize}
\item \textbf{Usuario}
\item \textbf{Administrador:} es un usuario normal, pero con funcionalidad añadida; sólo existe uno en el sistema.
\item \textbf{Pizarra:} es el actor principal de nuestra aplicación; es el responsable de interrelacionar a los usuario y al administrador.   
\end{itemize}

Los casos de uso más importantes para los usuarios son:
\begin{itemize}
\item \textbf{Iniciar sesión} en la pizarra
\item \textbf{Ver estadísticas} 
\item \textbf{Escribir (in)} en la pizarra
\item \textbf{Leer (out)} en la pizarra
\item \textbf{Lectura/Escritura (rd)} en la pizarra
\item \textbf{Mostrar estado}
\item \textbf{Buscar} en la pizarra
\item \textbf{Comparar} archivos en la pizarra
\item \textbf{Crear carpeta} en la pizarra
\end{itemize}

Los casos de uso para el Administrador son los mismos que los del usuario y además puede:
\begin{itemize}
\item \textbf{Crear usuario} en la pizarra
\item \textbf{Gestionar permisos} de los usuarios
\item \textbf{Configurar la pizarra}
\item \textbf{Actualizar estado} de la pizarra
\end{itemize}

Por último, los casos de uso de la pizarra son:
\begin{itemize}
\item \textbf{Mostrar estado}
\item \textbf{Buscar}
\item \textbf{Comparar} archivos
\item \textbf{Crear carpeta}
\item \textbf{Gestionar permisos} de los usuarios
\end{itemize} 

\begin{sidewaysfigure}
\centering
\casos
\caption{Diagrama de casos de uso}
\end{sidewaysfigure}

\subsection{Diagramas de actividad}
Un diagrama de actividad es una representación de un proceso de forma gráfica. Consta de una serie de símbolos que representan los distintos pasos a seguir y flechas que indican el flujo de ejecución que se sigue.\\

Como es común hemos realizado un diagrama de actividad para cada uno de los casos de uso que aparecen en el diagrama anterior.

\begin{itemize}
\item \textbf{Actualizar Pizarra:} éste es uno de los estados básicos de la pizarra, ya que cada vez se escribe o se borra algún archivo hay que hacer uso de éste.\\
Los pasos que sigue son obtener los nuevos datos de la pizarra, conectarse con la base de datos, guardar estos cambios y notificarlo.

\item \textbf{Buscar:} este caso de uso busca entre los datos de la pizarra y devuelve los datos en caso de que se hayan encontrado de acuerdo a los datos de la búsqueda.\\
Los pasos que se siguen son iniciar sesión, en caso de que los datos sean correctos, se introducen los datos de la búsqueda, se muestran estos datos si se han producido resultados, se actualiza la pizarra y finalmente se notifica.

\item \textbf{Comparar:} este caso de uso compara dos o más archivos y devuelve si se ha modificado algo y qué es lo que se ha modificado.\\
Los pasos que se siguen son iniciar sesión, se introducen los datos para comparar, se muestran los resultados si los hay, se actualiza la pizarra y se notifica.

\item \textbf{Configurar pizarra:} este caso de uso sirve para configurar la pizarra, cambiando los distintos parámetros.\\
Los pasos que siguen son iniciar sesión, se configura la pizarra, se actualiza la pizarra y se notifica al usuario.

\item \textbf{Crear carpeta:} este caso de uso permite crear nuevas carpetas a los usuarios.\\
Los pasos que sigue son se inicia sesión, se crea la carpeta, se actualiza la pizarra y se notifica al usuario.

\item \textbf{Comprobar nivel:} este caso de uso permite comprobar el nivel en el que se encuentra el usuario.\\
Los pasos a seguir son obtener los datos del usuario, conectar con la base de datos, buscar la información del usuario y mostrar las opciones del nivel.

\item \textbf{Crear usuario:} este caso de uso está restringido sólo al administrador. Crea un nuevo usuario en la pizarra.\\
Los pasos a seguir son iniciar sesión, introducir los datos del usuario, conectar con la base de datos para comprobar que los datos introducidos son correctos, se crea el nuevo usuario, se actualiza la base de datos y se notifica. En caso de que no se pueda iniciar sesión o los datos introducidos no sean válidos, también se notifica.

\item \textbf{Escribir (in):} éste es uno de las operaciones básicas de la pizarra. Escribe un nuevo dato en la pizarra.\\
Los pasos a seguir son iniciar sesión, escribir los datos que se quieren que se escriban, actualizar la pizarra y notificárselo al usuario.

\item \textbf{Lectura/Escritura (rd):} este caso de uso permite tanto leer como escribir en la pizarra.\\
Los pasos a seguir son iniciar sesión, leer datos de la pizarra, obtener la posición donde se va a escribir, escribir los datos, actualizar los datos y notificar los cambios producidos.

\item \textbf{Estadísticas:} permite ver las estadísticas de un determinado usuario.\\
Los pasos a seguir son iniciar sesión, introducir datos de las estadísticas buscadas, conectar con la base de datos, buscar las estadísticas y se muestran los resultados, si los hay.

\item \textbf{Gestionar permisos:} permite cambiar los permisos tanto de lectura como de escritura de un determinado usuario.\\
Los pasos a seguir son iniciar sesión, introducir datos del usuario a cambiar los permisos, conectar con la base de datos, se busca el usuario, si existe, se gestionan los permisos y se actualiza la base de datos, en caso contrario, se notifica que el usuario no existe.

\item  \textbf{Iniciar sesión:} se introduce el id de usuario y la contraseña para poder tener acceso.\\
Los pasos a seguir son introducir los datos (id de usuario y contraseña), conectar con la base de datos, se comprueban si los datos son válidos, si lo son se establece la conexión, se comprueban los permisos y se notifica, y si no son válidos también se notifica.

\item  \textbf{Leer (out):} leer datos de la pizarra.\\
Los pasos a seguir son iniciar sesión, leer datos que se van a leer, actualizar la pizarra y se notifica.

\item \textbf{Mostrar estado:} muestra el estado actual de la pizarra.\\
Los pasos a seguir son iniciar sesión, se muestra el estado de la pizarra, se actualiza la pizarra y se notifica al usuario.
\end{itemize}

Todos los diagramas se muestran a continuación: 

\vspace*{3cm}
\begin{figure}[!h,scale=0.3]
\centering
\actualizarPizarra\label{fig:actualizarPizarra}
\caption{Actualizar pizarra}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\buscar\label{fig:buscar}
\caption{Buscar}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\comparar\label{fig:comparar}
\caption{Comparar}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\configurarPizarra\label{fig:configurarPizarra}
\caption{Configurar pizarra}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\crearCarpeta\label{fig:crearCarpeta}
\caption{Crear carpeta}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\comprobarNivel\label{fig:comprobarNivel}
\caption{Comprobar nivel}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\crearUsuario\label{fig:crearUsuario}
\caption{Crear usuario}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\escribir\label{fig:escribir}
\caption{Escribir}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\lecturaEscritura\label{fig:lecturaEscritura}
\caption{Lectura/Escritura}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\estadisticas\label{fig:estadisticas}
\caption{Estadísticas}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\gestionarPermisos\label{fig:gestionarPermisos}
\caption{Gestionar permisos}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\iniciarSesion\label{fig:iniciarSesion}
\caption{Iniciar sesión}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\leer\label{fig:leer}
\caption{Leer}
\end{figure}
\newpage

\begin{figure}[!h]
\centering
\mostrarEstado\label{fig:mostrarEstado}
\caption{Mostrar estado}
\end{figure}
\newpage

\subsection{Diagrama de clases}
Un diagrama de clases es un diagrama estático destinado a la programación orientada a objetos que permite describir las clases de un sistema, así como sus propiedades, operaciones, relaciones entre ellas y herencia.\\

A continuación detallamos cada una de las clases que aparecen en el diagrama centrándose en la funcionalidad y las relaciones entre ellas. Para una descripción más en profundidad de las operaciones que implementa ver Manual de uso.\\

\textbf{Pizarra:} El diagrama de clases se centra en esta clase. Contiene las operaciones necesarias para que los agentes puedan interactuar con ella. Almacena los datos relacionados con el estado de la pizarra, así como la lista de usuarios, las estadísticas, los permisos y la configuración.\\

\textbf{Agente:} Permite interactuar con la pizarra, dando opciones para leer o escribir en la misma, así como modificar su configuración o permisos. Hace las veces de interfaz al usuario para usar la pizarra. Contiene el nombre de usuario y la contraseña con la que se interactúa con la pizarra.\\

\textbf{Estado:} Contiene la lista de elementos.\\

\textbf{Elemento:} Puede ser de dos tipos, representado como herencia. Un archivo o una carpeta. Una carpeta contendrá a su vez un listado de elementos.\\

\textbf{Nivel: }Proporciona las operaciones necesarias para comprobar y editar los permisos de la pizarra.\\

\textbf{Configuración: }Permite la visualización y modificación de las configuraciones de la pizarra.\\

\textbf{Estadísticas: }Permite visualizar las estadísticas.\\

\textbf{Usuario:} Permite la modificación y visualización de los datos del usuario, como el nombre, el id, la contraseña y los permisos.


\begin{sidewaysfigure}
\centering
\clases
\caption{Diagrama de clases}
\end{sidewaysfigure}





\subsection{Diagramas de secuencia}

El diagrama de secuencia es un diagrama UML utilizado para modelar la interacción entre objetos. Este diagrama se modela para cada caso de uso. Consta de dos tipos de mensajes:
\begin{enumerate}
	\item \textbf{Síncrono: }Corresponden con llamadas a métodos. Se representan con flechas rellenas en negro.
	\item \textbf{Asíncrono: }Terminan inmediatamente y crean un nuevo hilo de ejecución dentro de la secuencia. Se representan con flechas sin rellenar.
\end{enumerate}

Los diagramas de secuencia correspondientes a los casos de uso de nuestra plataforma se ponen a continuación.

\begin{figure}[!h]
\centering
\seqIniciarSesion
\caption{Diagrama de secuencia de iniciar sesión}
\end{figure}

\section{Diseño final}